<div>{{Prompt}}</div>

<hr id=answer>

<div id="command-display"></div>

<div id="correct-commands-back" style="display: none;">{{Command}}</div>

<script>
var commandDisplay = document.getElementById('command-display');
var correctCommandsDiv = document.getElementById('correct-commands-back');

if (commandDisplay && correctCommandsDiv) {
    var commandLines = correctCommandsDiv.innerHTML.split('<br>').filter(function(line) {
        return line.trim().length > 0;
    });
    
    function highlightBashAnki(element, text) {
        element.innerHTML = '';
        
        var tokens = text.match(/(#.*|["'][^"']*["']|--?\w+|\$[@0#?!]|\$\w+|[|&;><]|\|\||&&|>>|[^ \t\n\r"'$&|;()<>`]+|[ \t\n\r]+)/g) || [];
        
        var isFirstWord = true;
        
        tokens.forEach(function(token) {
            var type = 'text';
            
            if (token.match(/^#/)) type = 'comment';
            else if (token.match(/^["']/)) type = 'string';
            else if (token.match(/^\$\w/)) type = 'variable';
            else if (token.match(/^\$[@0#?!]/)) type = 'variable';
            else if (token.match(/^--/)) type = 'flag-long';
            else if (token.match(/^-\w/)) type = 'flag';
            else if (token.match(/^(&&|\|\||>>|>|<|&|\||;)/)) type = 'symbol';
            else if (isFirstWord && token.match(/^\w/)) {
                type = 'cmd';
                isFirstWord = false;
            }
            
            if (token.match(/^[ \t\n\r]+/)) {
                element.appendChild(document.createTextNode(token));
            } else {
                var span = document.createElement('span');
                span.className = type;
                span.textContent = token;
                element.appendChild(span);
            }
        });
    }
    
    commandLines.forEach(function(line, index) {
        var lineContainer = document.createElement('div');
        lineContainer.className = 'bash-code';
        commandDisplay.appendChild(lineContainer);
        
        highlightBashAnki(lineContainer, line);
    });
}
</script>
